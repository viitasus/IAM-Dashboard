<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ resource.name }} - Resource Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            padding-top: 20px;
        }
        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            margin-bottom: 20px;
        }
        .card-header {
            background-color: #f8f9fa;
            border-bottom: 1px solid #e3e6f0;
            font-weight: bold;
        }
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .dashboard-title {
            font-size: 2rem;
            font-weight: bold;
            color: #333;
        }
        .dashboard-subtitle {
            color: #6c757d;
            font-size: 1.2rem;
            margin-top: 5px;
        }
        .dashboard-actions {
            display: flex;
            gap: 10px;
        }
        .project-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .project-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .utilization-container {
            height: 30px;
            background-color: #e9ecef;
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }
        .utilization-bar {
            height: 100%;
            text-align: center;
            color: white;
            font-weight: bold;
            padding-top: 5px;
        }
        .stats-card {
            text-align: center;
            padding: 15px;
        }
        .stats-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }
        .stats-label {
            color: #6c757d;
            font-size: 1rem;
        }
        .badge-custom {
            font-size: 0.8rem;
            padding: 5px 10px;
            border-radius: 10px;
        }
        .project-table th {
            background-color: #f8f9fa;
        }
        .chart-container {
            height: 300px;
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="dashboard-header">
            <div>
                <div class="dashboard-title">
                    <i class="bi bi-person-circle"></i> {{ resource.name }}
                </div>
                <div class="dashboard-subtitle">
                    {% if resource.role is defined %}
                        <i class="bi bi-person-badge"></i> {{ resource.role }}
                    {% endif %}
                    {% if resource.department is defined %}
                        &nbsp;|&nbsp; <i class="bi bi-building"></i> {{ resource.department }}
                    {% endif %}
                </div>
            </div>
            <div class="dashboard-actions">
                <a href="{{ url_for('resources', filename=filename) }}" class="btn btn-outline-primary">
                    <i class="bi bi-people"></i> All Resources
                </a>
                <a href="{{ url_for('dashboard', filename=filename) }}" class="btn btn-outline-secondary">
                    <i class="bi bi-bar-chart-line"></i> Dashboard
                </a>
            </div>
        </div>

        <!-- Resource Stats Overview -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card stats-card">
                    <div class="stats-label">Total Projects</div>
                    <div class="stats-value">{{ resource.projects|length }}</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stats-card">
                    <div class="stats-label">Allocated Days (2025)</div>
                    <div class="stats-value">{{ resource.total_allocated|default(0)|round(1) }}</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card stats-card">
                    <div class="stats-label">Utilized Days (2025)</div>
                    <div class="stats-value">{{ resource.total_utilized|default(0)|round(1) }}</div>
                </div>
            </div>
        </div>

        <!-- Resource Utilization -->
        {% if resource.utilization_rate is defined %}
        <div class="card mb-4">
            <div class="card-header">
                Resource Utilization
            </div>
            <div class="card-body">
                <div class="utilization-container">
                    <div class="utilization-bar 
                        {{ 'bg-danger' if resource.utilization_rate < 30 else 
                           'bg-warning' if resource.utilization_rate < 70 else 
                           'bg-success' }}" 
                        style="width: {{ resource.utilization_rate }}%;">
                        {{ resource.utilization_rate|round(1) }}%
                    </div>
                </div>
                <div class="row text-center">
                    <div class="col-md-4">
                        <div class="text-danger">Under-utilized (< 30%)</div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-warning">Moderate (30-70%)</div>
                    </div>
                    <div class="col-md-4">
                        <div class="text-success">Optimal (> 70%)</div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Project Charts -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Project Allocation Distribution
                    </div>
                    <div class="card-body">
                        <div id="allocation_pie_chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        Project Utilization Comparison
                    </div>
                    <div class="card-body">
                        <div id="utilization_bar_chart" class="chart-container"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Project List -->
        <div class="card mb-4">
            <div class="card-header">
                Assigned Projects/Support
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover project-table">
                        <thead>
                            <tr>
                                <th>Project Name</th>
                                <th>Engagement Type</th>
                                <th>Allocated Days</th>
                                <th>Utilized Days</th>
                                <th>Utilization Rate</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for project in resource.projects %}
                            <tr>
                                <td>
                                    <strong>{{ project.name }}</strong>
                                </td>
                                <td>
                                    {% if project.engagement_type is defined %}
                                        <span class="badge 
                                            {{ 'bg-primary' if project.engagement_type == 'Professional Services' else 
                                               'bg-success' if project.engagement_type == 'Support' else 
                                               'bg-info' }}">
                                            {{ project.engagement_type }}
                                        </span>
                                    {% else %}
                                        <span class="badge bg-secondary">Not Specified</span>
                                    {% endif %}
                                </td>
                                <td>{{ project.allocated|default(0)|round(1) }}</td>
                                <td>{{ project.utilized|default(0)|round(1) }}</td>
                                <td>
                                    {% if project.project_utilization is defined %}
                                        <div class="progress">
                                            <div class="progress-bar 
                                                {{ 'bg-danger' if project.project_utilization < 30 else 
                                                   'bg-warning' if project.project_utilization < 70 else 
                                                   'bg-success' }}" 
                                                role="progressbar" 
                                                style="width: {{ project.project_utilization }}%;" 
                                                aria-valuenow="{{ project.project_utilization }}" 
                                                aria-valuemin="0" 
                                                aria-valuemax="100">
                                                {{ project.project_utilization|round(1) }}%
                                            </div>
                                        </div>
                                    {% else %}
                                        N/A
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Create the charts
        document.addEventListener('DOMContentLoaded', function() {
            // Allocation pie chart
            const pieData = [
                {% for project in resource.projects %}
                    {% if project.allocated is defined %}
                    {
                        name: "{{ project.name }}",
                        value: {{ project.allocated|default(0) }}
                    },
                    {% endif %}
                {% endfor %}
            ];
            
            // Skip creating the chart if no allocation data
            if (pieData.length > 0) {
                const pieLayout = {
                    margin: { t: 10, b: 10, l: 10, r: 10 },
                    showlegend: true,
                    legend: { orientation: 'h', y: -0.2 }
                };
                
                Plotly.newPlot('allocation_pie_chart', [{
                    type: 'pie',
                    labels: pieData.map(p => p.name),
                    values: pieData.map(p => p.value),
                    hole: 0.4,
                    textinfo: 'label+percent',
                    insidetextorientation: 'radial'
                }], pieLayout);
            }
            
            // Utilization bar chart
            const barData = [
                {% for project in resource.projects %}
                    {% if project.allocated is defined and project.utilized is defined %}
                    {
                        name: "{{ project.name }}",
                        allocated: {{ project.allocated|default(0) }},
                        utilized: {{ project.utilized|default(0) }}
                    },
                    {% endif %}
                {% endfor %}
            ];
            
            // Skip creating the chart if no utilization data
            if (barData.length > 0) {
                const barLayout = {
                    margin: { t: 10, b: 80, l: 60, r: 10 },
                    showlegend: true,
                    barmode: 'group',
                    xaxis: {
                        tickangle: -45,
                        automargin: true
                    },
                    yaxis: {
                        title: 'Days'
                    },
                    legend: { orientation: 'h', y: -0.2 }
                };
                
                Plotly.newPlot('utilization_bar_chart', [
                    {
                        x: barData.map(p => p.name),
                        y: barData.map(p => p.allocated),
                        type: 'bar',
                        name: 'Allocated'
                    },
                    {
                        x: barData.map(p => p.name),
                        y: barData.map(p => p.utilized),
                        type: 'bar',
                        name: 'Utilized'
                    }
                ], barLayout);
            }
        });
    </script>
</body>
</html>